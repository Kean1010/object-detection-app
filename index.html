<script src="https://apis.google.com/js/api.js"></script>
<script>
  // Initialize Google API client
  function initClient() {
    gapi.client.init({
      apiKey: "YOUR_API_KEY",
      clientId: "YOUR_CLIENT_ID",
      discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
      scope: "https://www.googleapis.com/auth/drive.file",
    }).then(() => {
      console.log("Google API initialized.");
    });
  }

  // Load the Google API client
  gapi.load("client:auth2", initClient);

  // Handle image uploads
  document.getElementById('train-button').addEventListener('click', async () => {
    const files = document.getElementById('image-upload').files;
    const label = document.getElementById('label-input').value.trim();
    const statusDiv = document.getElementById('upload-status');

    if (!files.length || !label) {
      statusDiv.textContent = 'Please upload images and provide a label.';
      return;
    }

    statusDiv.textContent = 'Uploading images...';

    try {
      await gapi.auth2.getAuthInstance().signIn(); // Authenticate the user
      for (const file of files) {
        const metadata = {
          name: `${label}/${file.name}`,
          parents: ["YOUR_FOLDER_ID"], // Replace with your Google Drive folder ID
        };

        const formData = new FormData();
        formData.append("metadata", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
        formData.append("file", file);

        const response = await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart", {
          method: "POST",
          headers: {
            Authorization: `Bearer ${gapi.auth.getToken().access_token}`,
          },
          body: formData,
        });

        if (!response.ok) {
          throw new Error("Failed to upload file.");
        }
      }
      statusDiv.textContent = 'Images uploaded successfully!';
    } catch (error) {
      console.error('Error:', error);
      statusDiv.textContent = 'Error uploading images. Please try again.';
    }
  });
</script>
